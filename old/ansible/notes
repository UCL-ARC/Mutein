AWS VM setup through web console

enable ebs encryption
launch instance
debian 11 8GB gp2
AMI from catalog debian-11-amd64-20221205-1220 / ami-03c5ca432499db74d
t2.micro 1vCPU 1GB RAM
create key pair ED25519 PEM robs_aws_key1 username is admin??
auto assign public ip
create security group:
allow ssh from my ip 143.159.32.93
extra volumes:
4 x 200GB

c6i.large 2vcpu 4GBram 12.5Gbps(net) 10Gbps(EBS)

get IP from EC2 console
ssh admin@63.35.181.222 -i <pem-file>
 - download security updates
   - inside screen: sudo apt update && sudo apt upgrade && sudo reboot
 - setup ufw firewall??
   - sudo apt install ufw
   - sudo ufw allow ssh
 - raid0
   - sudo apt install mdadm xfsprogs
   - sudo mdadm --create --verbose /dev/md0 --level=0 --raid-devices=4 /dev/sd[bcde]
   - sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf
   - sudo mkfs.xfs /dev/md0
   - sudo mkdir -p /mnt/raid0
   - sudo mount -o inode64 /dev/md0 /mnt/raid0
   - sudo update-initramfs -u
   - lsblk -f | grep md0 # get uuid of the raid0 filesystem
   - sudo nano /etc/fstab
   <UUID> /mnt/raid0 xfs rw,relatime,attr2,inode64,noquota 0 1
   - sudo mkdir -p /mnt/raid0/admin && sudo chown admin:admin /mnt/raid0/admin
   - echo test data > /mnt/raid0/admin/testfile
   - sudo reboot
 - throughput testing
   - dd if=/dev/zero of=/mnt/raid0/admin/test1.img bs=1G count=1 oflag=dsync
 - limited user
   - sudo adduser vicker
   - sudo mkdir /mnt/raid0/vicker && sudo chown vicker:vicker /mnt/raid0/vicker
   - su vicker
   - cd && mkdir -p .ssh && touch .ssh/authorized_keys
   - chmod 700 .ssh && chmod 600 .ssh/authorized_keys
   - nano .ssh/authorized_keys #add public key from whereever you will log in from
   - ssh-keygen -t ed25519
 - install mamba
   - cd && wget https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Linux-x86_64.sh
   - chmod u+x Mambaforge-Linux-x86_64.sh && ./Mambaforge-Linux-x86_64.sh
 - checkout mutein and setup data folder
   - authorise the ed25519 key we made in ~/.ssh on github
     - https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account
   - mkdir -p ~/repos && cd ~/repos
   - git clone git@github.com:UCL/Mutein.git
   - mkdir /mnt/raid0/vicker/549_mutein && cd && ln -s /mnt/raid0/vicker/549_mutein
   - follow instructions here: https://github.com/UCL/Mutein/blob/main/Documents/variant_calling.md#setup-your-data-folder
 - gridengine
   - hostname --fqdn ==> ip-172-31-8-119.eu-west-1.compute.internal
   - sudo apt-get install gridengine-master gridengine-qmon xfonts-100dpi xfonts-75dpi
   - auto yes / cellname default / sge master hostname ip-172-31-8-119.eu-west-1.compute.internal
   - sudo apt-get install gridengine-exec

 - ansible from laptop to configure??
 - gridengine
 - checkout mutein
 - test on keogh

what's already installed?:
 - screen
 - sudo
what I installed:
 - ufw
 - xfsprogs
 - git
 - gcc (for /usr/bin/cpp for gridengine)

throughput tests:
EBS limit for c6i.large is 10Gb/s = 1250MB/s
my calculations suggest 4 * 200GB volumes should give base 32MB/s and burst 200MB/s
admin@ip-172-31-8-119:~$ dd if=/dev/zero of=/mnt/raid0/admin/test1.img bs=1G count=1 oflag=dsync
1073741824 bytes (1.1 GB, 1.0 GiB) copied, 4.88895 s, 220 MB/s

admin@ip-172-31-8-119:~$ dd if=/dev/zero of=/mnt/raid0/admin/test1.img bs=2G count=1 oflag=dsync
2147479552 bytes (2.1 GB, 2.0 GiB) copied, 10.5277 s, 204 MB/s

admin@ip-172-31-8-119:~$ dd if=/dev/zero of=/home/admin/test1.img bs=1G count=1 oflag=dsync
1073741824 bytes (1.1 GB, 1.0 GiB) copied, 7.38801 s, 145 MB/s

admin@ip-172-31-8-119:~$ dd if=/dev/zero of=/home/admin/test1.img bs=2G count=1 oflag=dsync
2147479552 bytes (2.1 GB, 2.0 GiB) copied, 15.5879 s, 138 MB/s

larger OS disk or separate volume for home???
to install conda dependencies



this ansible setup is to automate the configuration of a compute node that will run yamlmake
and use slurm to submit jobs to itself
only ssh access to the compute node should be required

set up ansible a local ubuntu linux vm:

  sudo apt -y install software-properties-common
  sudo apt-add-repository ppa:ansible/ansible
  sudo apt install ansible

