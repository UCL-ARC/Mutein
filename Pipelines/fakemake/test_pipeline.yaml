- config:
    expected_working_dir: "/lustre/scratch/scratch/{$USER}/549_mutein"
    log_prefix:           "mut."
    test_dir:             "test"
    mut_prefix:           "{$MUT_PREFIX}"
    user:                 "{mut_prefix}{$USER}_{test_dir}"
    temp_job_dir:         "fakemake_jobs"
    stale_output_file:    "recycle"
    stale_output_dir:     "ignore"
    missing_parent_dir:   "create"
    #conda_setup_command:  ""

- include: "test_include.yaml"

- module: "test_module/module.yaml"

- rule:
    name:     "step1"
    exec:     "local"
    time:     "1:00:00"
    mem:      "2G"
    cores:    "1"
    conda:    "{mut_prefix}main"
    data_dir: "{test_dir}/input"
    input:    "{data_dir}/{=sample}.input"
    output:   "{test_dir}/output/{=sample}.step1"
    shell: |
      cat {input} > {output}
      echo processed by {name} >> {output}
      echo "{input}" | grep -v -e '1\.input' #should cause task1 to fail
      
- rule:
    name: "step2"
    exec: "local"
    time:     "0:30:00"
    mem:      "2G"
    cores:    "2"
    conda: "{$MUT_PREFIX}main"
    input:
      step1: "{test_dir}/output/{=sample}.step1"
    output:
      final: "{test_dir}/output/{=sample}.step2"
    shell: |
      cat {step1} > {final}
      echo processed by {name} >> {final}
      echo "hello"
# - rule:
#     name: step4
#     conda: "{$MUT_PREFIX}main"
#     input:
#       read1: "datasets/{=dataset}/{=subset}/{=accession}/{=accession}_1.fastq.gz"
#       read2: "datasets/{=dataset}/{=subset}/{=accession}/{=accession}_2.fastq.gz"
#     output:
#       info: "datasets/{=dataset}/{=subset}/{=accession}/{=accession}.info"
#     exec: qsub
#     shell: |
#       file {read1} {read2} > {info}
#       echo {$USER} processed >> {info}
