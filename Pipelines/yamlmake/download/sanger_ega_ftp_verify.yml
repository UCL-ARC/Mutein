#define dataset_id, subset_list, credentials
- config:
    dataset_id: "sanger_ega_ftp"

    subset_id:
      #- "EGAD00001000825" #B1 martincorena2015 CS
      #- "EGAD00001001090" #B1 martincorena2015 CS
      - "EGAD00001001123" #B1 martincorena2015 Myriad
      #- "EGAD00001004158" #B1 fowler2021,martincorena2018 CS
      - "EGAD00001004159" #B1 fowler2021,martincorena2018 Myriad
      #- "EGAD00001004192" #B2 leesix2019
      - "EGAD00001004193" #B1 leesix2019 Myriad
      #- "EGAD00001006194" #B4? fowler2021
      - "EGAD00001006969" #B1 fowler2021 Myriad
      #- "EGAD00001006113" #B1 lawson2020 Myriad
      #- "EGAD00001006114" #B1 lawson2020 Myriad
      #- "EGAD00001006115" #B1 lawson2020 Myriad
      #- "EGAD00001006116" #B1 lawson2020 Myriad
      #- "EGAD00001006117" #B1 lawson2020 Myriad
      #- "EGAD00001004578" #B3 brunner2019

    credentials: "{$MUT_DATA}/config/private_config3.txt"

#test md5 of all ftp downloaded files
- action:
    name: "verify_ftp_downloads"
    exec: "qsub"
    qsub:
      time:  "1:00:00"
      mem:   "4G"
      cores: "1"

    input:
        #             eg datasets/sanger_ega_ftp/EGAD00001001123/13726_1.cram.cip
        accession_file: "datasets/{%dataset_id}/{=subset_id}/{*accession}.cip"

    output:
        touch: "datasets/{%dataset_id}/{=subset_id}/.meta/{%name}.{*accession}.touch"

    shell: |
        md5_file="{%accession_file}.md5"
        expected=$(cat "${md5_file}")
        observed=$(cat "{%accession_file}" | md5sum | awk '{print $1}')
        [[ "${expected}" == "${observed}" ]] && touch {%touch}

