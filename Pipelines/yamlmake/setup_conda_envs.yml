#setup one conda environment given an "env" file listing the packages
#touch an output file to flag that env has been created
- action:
    name: "setup_conda_envs"
    base_dir: "{$MUT_DIR}/Pipelines/conda_envs"
    input:
        env_file: "{%base_dir}/{*env_name}.env"
    output:
        touch: "config/conda_envs/{*env_name}.touch"
    shell: |
        mamba create -y \
                     {%conda_channels} \
                     -n {%ym/conda_prefix}{*env_name}
        conda activate {%ym/conda_prefix}{*env_name}
        config_rc_file="{%base_dir}/{*env_name}.condarc"
        #if [ -f "$config_rc_file" ]; then
            #cp "$config_rc_file" ${CONDA_PREFIX}/.condarc
        #fi
        mamba install -y \
                     {%conda_channels} \
                     --file {%env_file} 
        touch {%touch}
